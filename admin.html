<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel Administrativo</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Painel Administrativo</h1>

  <form id="cadastroForm">
    <input type="text" id="nome" placeholder="Nome" required />
    <input type="text" id="cpf" placeholder="CPF" required />
    <input type="file" id="fotos" accept="image/*" multiple required />
    <button type="submit">Cadastrar</button>
    <button type="button" onclick="voltarInicio()">Voltar à Página Inicial</button>
  </form>

  <h2>Lista de Cadastrados</h2>
  <div id="listaCadastrados"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = 'https://cdstzbtewwbwjqhvhigy.supabase.co';
    const SUPABASE_KEY = 'YOUR_PUBLIC_ANON_KEY';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    document.getElementById('cadastroForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const nome = document.getElementById('nome').value.trim();
      const cpf = document.getElementById('cpf').value.trim();
      const arquivos = document.getElementById('fotos').files;

      const urls = [];

      for (const arquivo of arquivos) {
        const nomeArquivo = `${Date.now()}_${arquivo.name}`;
        const { data, error } = await supabase.storage
          .from('fotos')
          .upload(nomeArquivo, arquivo);

        if (!error) {
          const { data: urlData } = supabase.storage
            .from('fotos')
            .getPublicUrl(nomeArquivo);
          urls.push(urlData.publicUrl);
        }
      }

      const { error: insertError } = await supabase
        .from('formandos')
        .insert([{ nome, cpf, fotos: urls }]);

      if (!insertError) {
        alert('Cadastro realizado com sucesso!');
        document.getElementById('cadastroForm').reset();
        carregarLista();
      } else {
        alert('Erro ao cadastrar!');
        console.error(insertError);
      }
    });

    async function carregarLista() {
      const { data, error } = await supabase
        .from('formandos')
        .select('nome, cpf, fotos');

      const container = document.getElementById('listaCadastrados');
      container.innerHTML = '';

      if (data) {
        data.forEach(item => {
          const div = document.createElement('div');
          div.textContent = `${item.nome} - ${item.cpf} (${item.fotos?.length || 0} fotos)`;
          container.appendChild(div);
        });
      }
    }

    function voltarInicio() {
      window.location.href = 'index.html';
    }

    carregarLista();
  </script>
</body>
</html>
