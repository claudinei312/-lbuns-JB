<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo</title>
</head>
<body>
    <h2>Painel Administrativo</h2>
    <a href="index.html">Voltar para a página inicial</a>
    <form id="cadastro-form">
        <input type="text" id="nome" placeholder="Nome" required>
        <input type="text" id="cpf" placeholder="CPF" required>
        <input type="file" id="foto" accept="image/*" required multiple>
        <button type="submit">Cadastrar</button>
    </form>

    <h3>Lista de Registros</h3>
    <ul id="lista-registros"></ul>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';  // https://supabase.com/dashboard/project/cdstzbtewwbwjqhvhigy
        const SUPABASE_KEY = 'YOUR_SUPABASE_KEY';  // eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNkc3R6YnRld3did2pxaHZoaWd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYyOTk1MzMsImV4cCI6MjA2MTg3NTUzM30.CSUSb1NFFjf2MYLjPjiOS-RZdvavTxeqr_-T74Lum78 seu Supabase aqui
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Verifica se o usuário está logado
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'login.html'; // Redireciona para o login caso não esteja logado
        }

        // Função para cadastrar dados
        document.getElementById('cadastro-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const nome = document.getElementById('nome').value;
            const cpf = document.getElementById('cpf').value;
            const fotos = document.getElementById('foto').files;

            // Faz upload das fotos para o Supabase
            let fotosUrls = [];
            for (const foto of fotos) {
                const { data, error } = await supabase.storage
                    .from('fotos')
                    .upload('fotos/' + Date.now() + foto.name, foto);
                if (data) {
                    const url = supabase.storage.from('fotos').getPublicUrl(data.path).publicURL;
                    fotosUrls.push(url);
                } else {
                    console.error('Erro no upload da foto:', error.message);
                    alert('Erro no upload da foto!');
                    return;
                }
            }

            // Salva os dados no Supabase
            const { data, error } = await supabase.from('clientes').insert([
                {
                    nome: nome,
                    cpf: cpf,
                    fotos: fotosUrls,
                },
            ]);

            if (data) {
                alert('Cadastro realizado com sucesso!');
                loadLista();  // Recarrega a lista de registros após o cadastro
            } else {
                alert('Erro ao cadastrar: ' + error.message);
            }
        });

        // Função para carregar a lista de registros
        async function loadLista() {
            const { data, error } = await supabase.from('clientes').select();
            const lista = document.getElementById('lista-registros');
            lista.innerHTML = '';
            if (error) {
                console.error('Erro ao carregar registros:', error.message);
                return;
            }

            data.forEach(cliente => {
                const li = document.createElement('li');
                li.textContent = `${cliente.nome} - ${cliente.cpf}`;
                lista.appendChild(li);
            });
        }

        loadLista();
    </script>
</body>
</html>
